function shareFriend(){WeixinJSBridge.invoke("sendAppMessage",{appid:WeiXin.appid,img_url:WeiXin.imgUrl,img_width:"64",img_height:"64",link:WeiXin.lineLink,desc:WeiXin.shareTitle,title:"小黄人过河"},function(){})}function shareTimeline(){WeixinJSBridge.invoke("shareTimeline",{img_url:WeiXin.imgUrl,img_width:"64",img_height:"64",link:WeiXin.lineLink,desc:"",title:WeiXin.shareTitle},function(){})}function shareWeibo(){WeixinJSBridge.invoke("shareWeibo",{content:WeiXin.descContent,url:WeiXin.lineLink},function(){})}function onBridgeReady(){WeixinJSBridge.on("menu:share:appmessage",shareFriend),WeixinJSBridge.on("menu:share:timeline",shareTimeline),WeixinJSBridge.on("menu:share:weibo",shareWeibo)}window.WeiXin={imgUrl:"http://brucexiejunling.github.io/crossing-the-river/favicon.ico",lineLink:location.href,shareTitle:"[小黄人过河游戏], 想知道你有多6吗? 想自虐吗? 来挑战吧!",appid:""},document.addEventListener?document.addEventListener("WeixinJSBridgeReady",onBridgeReady,!1):document.attachEvent&&(document.addEventListener("WeixinJSBridgeReady",onBridgeReady),document.addEventListener("onWeixinJSBridgeReady",onBridgeReady));
!function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d}}(),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var Quintus=function(a){var b={};return b.options={imagePath:"images/",audioPath:"audios/",dataPath:"data/",audioSupported:["mp3","ogg"],sound:!0},a&&_(b.options).extend(a),b._normalizeArg=function(a){return _.isString(a)&&(a=a.replace(/\s+/g,"").split(",")),_.isArray(a)||(a=[a]),a},b.extend=function(a){return _(b).extend(a),b},b.include=function(a){return _.each(b._normalizeArg(a),function(a){(a=Quintus[a]||a)(b)}),b},b.gameLoop=function(a){b.lastGameLoopFrame=(new Date).getTime(),b.gameLoopCallbackWrapper=function(c){b.loop=requestAnimationFrame(b.gameLoopCallbackWrapper);var d=c-b.lastGameLoopFrame,e=16.7;if(d>16.7)for(;d>16.7;)d-=e,a.call(b,e/1e3);else a.call(b,d/1e3);b.lastGameLoopFrame=c},requestAnimationFrame(b.gameLoopCallbackWrapper)},b.pauseGame=function(){b.loop&&cancelAnimationFrame(b.loop),b.loop=null},b.unpauseGame=function(){b.loop||(b.lastGameLoopFrame=(new Date).getTime(),b.loop=requestAnimationFrame(b.gameLoopCallbackWrapper))},b.Evented=Class.extend({bind:function(a,b,c){c||(c=b,b=null),_.isString(c)&&(c=b[c]),this.listeners=this.listeners||{},this.listeners[a]=this.listeners[a]||[],this.listeners[a].push([b||this,c]),b&&(b.binds||(b.binds=[]),b.binds.push([this,a,c]))},trigger:function(a,b){if(this.listeners&&this.listeners[a])for(var c=0,d=this.listeners[a].length;d>c;c++){var e=this.listeners[a][c];e[1].call(e[0],b)}},unbind:function(a,b,c){if(b){var d=this.listeners&&this.listeners[a];if(d)for(var e=d.length-1;e>=0;e--)d[e][0]==b&&(c&&c!=d[e][1]||this.listeners[a].splice(e,1))}else this.listeners[a]&&delete this.listeners[a]},debind:function(){if(this.binds)for(var a=0,b=this.binds.length;b>a;a++){var c=this.binds[a],d=c[0],e=c[1];d.unbind(e,this)}}}),b.components={},b.register=function(a,c){c.name=a,b.components[a]=b.Component.extend(c)},b.Component=b.Evented.extend({init:function(a){this.entity=a,this.extend&&_.extend(a,this.extend),a[this.name]=this,a.activeComponents.push(this.name),this.added&&this.added()},destroy:function(){if(this.extend)for(var a=_.keys(this.extend),b=0,c=a.length;c>b;b++)delete this.entity[a[b]];delete this.entity[this.name];var d=this.entity.activeComponents.indexOf(this.name);-1!=d&&this.entity.activeComponents.splice(d,1),this.debind(),this.destroyed&&this.destroyed()}}),b.GameObject=b.Evented.extend({has:function(a){return this[a]?!0:!1},add:function(a){a=b._normalizeArg(a),this.activeComponents||(this.activeComponents=[]);for(var c=0,d=a.length;d>c;c++){var e=a[c],f=b.components[e];if(!this.has(e)&&f){var g=new f(this);this.trigger("addComponent",g)}}return this},del:function(a){a=b._normalizeArg(a);for(var c=0,d=a.length;d>c;c++){var e=a[c];e&&this.has(e)&&(this.trigger("delComponent",this[e]),this[e].destroy())}return this},destroy:function(){this.destroyed||(this.debind(),this.parent&&this.parent.remove&&this.parent.remove(this),this.trigger("removed"),this.destroyed=!0)}}),b.setup=function(a,c){var d="ontouchstart"in document;c=c||{},a=a||"quintus",b.el=$(_.isString(a)?"#"+a:a),0===b.el.length&&(b.el=$("<canvas width='320' height='420'></canvas>").attr("id",a).appendTo("body"));var e=c.maxWidth||5e3,f=c.maxHeight||5e3,g=c.resampleWidth,h=c.resampleHeight;if(c.maximize){$("html, body").css({padding:0,margin:0});var i=Math.min(window.innerWidth,e),j=Math.min(window.innerHeight-5,f);d&&(b.el.css({height:2*j}),window.scrollTo(0,1),i=Math.min(window.innerWidth,e),j=Math.min(window.innerHeight-5,f)),b.el.css({width:i,height:j}).attr((g&&i>g||h&&j>h)&&d?{width:i/2,height:j/2}:{width:i,height:j})}return c.fullScreen&&d&&b.setFullScreen(document.documentElement),b.wrapper=b.el.wrap("<div id='"+a+"_container'/>").parent().css({width:b.el.width(),margin:"0 auto"}),b.el.css("position","relative"),b.ctx=b.el[0].getContext&&b.el[0].getContext("2d"),d&&window.scrollTo(0,1),b.width=parseInt(b.el.attr("width"),10),b.height=parseInt(b.el.attr("height"),10),$(window).bind("orientationchange",function(){setTimeout(function(){window.scrollTo(0,1)},0)}),b},b.setFullScreen=function(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},b.clear=function(){b.ctx.clearRect(0,0,b.el[0].width,b.el[0].height)},b.assetTypes={png:"Image",jpg:"Image",gif:"Image",jpeg:"Image",ogg:"Audio",wav:"Audio",m4a:"Audio",mp3:"Audio"},b.assetType=function(a){var c=_(a.split(".")).last().toLowerCase();return b.assetTypes[c]||"Other"},b.loadAssetImage=function(a,c,d,e){var f=new Image;$(f).on("load",function(){d(a,f)}),$(f).on("error",e),f.src=b.options.imagePath+c},b.audioMimeTypes={mp3:"audio/mpeg",ogg:'audio/ogg; codecs="vorbis"',m4a:"audio/m4a",wav:"audio/wav"},b.loadAssetAudio=function(a,c,d,e){if(!document.createElement("audio").play||!b.options.sound)return void d(a,null);var f=new Audio,g=b._removeExtension(c),h=null;return(h=_(b.options.audioSupported).detect(function(a){return f.canPlayType(b.audioMimeTypes[a])?a:null}))?($(f).on("error",e),$(f).on("canplaythrough",function(){d(a,f)}),f.src=b.options.audioPath+g+"."+h,f.load(),f):void d(a,null)},b.loadAssetOther=function(a,c,d,e){$.get(b.options.dataPath+c,function(b){d(a,b)}).fail(e)},b._removeExtension=function(a){return a.replace(/\.(\w{3,4})$/,"")},b.assets={},b.asset=function(a){return b.assets[a]},b.load=function(a,c,d){var e={};d||(d={});var f=d.progressCallback,g=!1,h=function(a){g=!0,(d.errorCallback||function(a){alert("Error Loading: "+a)})(a)};_.isArray(a)?_.each(a,function(a){_.isObject(a)?_.extend(e,a):e[a]=a}):_.isString(a)?e[a]=a:e=a;var i=_(e).keys().length,j=i,k=function(a,d){g||(b.assets[a]=d,j--,f&&f(i-j,i),0===j&&c&&c.apply(b))};_.each(e,function(a,c){var d=b.assetType(a);b.assets[c]?k(c,b.assets[c]):b["loadAsset"+d](c,a,k,function(){h(a)})})},b.preloads=[],b.preload=function(a,c){_(a).isFunction()?(b.load(_(b.preloads).uniq(),a,c),b.preloads=[]):b.preloads=b.preloads.concat(a)},b};
Quintus.Sprites=function(a){return a.SpriteSheet=Class.extend({init:function(b,c,d){_.extend(this,{name:b,asset:c,w:a.asset(c).width,h:a.asset(c).height,tilew:40,tileh:55,sx:0,sy:0},d),this.cols=this.cols||Math.floor(this.w/this.tilew)},fx:function(a){return a%this.cols*this.tilew+this.sx},fy:function(a){return Math.floor(a/this.cols)*this.tileh+this.sy},draw:function(b,c,d,e){b||(b=a.ctx),b.drawImage(a.asset(this.asset),this.fx(e),this.fy(e),this.tilew,this.tileh,Math.floor(c),Math.floor(d),.5*this.tilew,.5*this.tileh)}}),a.sheets={},a.sheet=function(b,c,d){return c?void(a.sheets[b]=new a.SpriteSheet(b,c,d)):a.sheets[b]},a.compileSheets=function(b,c){var d=a.asset(c);_(d).each(function(c,d){a.sheet(d,b,c)})},a.Sprite=a.GameObject.extend({init:function(a){this.p=_({x:0,y:0,z:0,frame:0,type:0}).extend(a||{}),this.p.w&&this.p.h||(this.asset()?(this.p.w=this.p.w||this.asset().width,this.p.h=this.p.h||this.asset().height):this.sheet()&&(this.p.w=this.p.w||this.sheet().tilew,this.p.h=this.p.h||this.sheet().tileh)),this.p.id=this.p.id||_.uniqueId()},asset:function(){return a.asset(this.p.asset)},sheet:function(){return a.sheet(this.p.sheet)},draw:function(b){b||(b=a.ctx);var c=this.p;c.sheet?this.sheet().draw(b,c.x,c.y,c.frame):c.asset&&b.drawImage(a.asset(c.asset),Math.floor(c.x),Math.floor(c.y)),this.trigger("draw",b)},step:function(a){this.trigger("step",a)}}),a.Rectangle=a.GameObject.extend({init:function(a){this.p=_({x:0,y:0,w:0,h:0,color:"#000"}).extend(a||{}),this.p.id=this.p.id||_.uniqueId()},draw:function(b){b||(b=a.ctx);var c=this.p;b.fillStyle=c.color,b.fillRect(c.x,c.y,c.w,c.h),this.trigger("draw",b)},step:function(a){this.trigger("step",a)}}),a};
Quintus.Scenes=function(a){a.scenes={},a.stages=[],a.Scene=Class.extend({init:function(a,b){this.opts=b||{},this.sceneFunc=a}}),a.scene=function(b,c){return c?(a.scenes[b]=c,c):a.scenes[b]},a.Stage=a.GameObject.extend({defaults:{sort:!0},init:function(a){this.scene=a,this.items=[],this.index={},this.removeList=[],a&&(this.options=_(this.defaults).clone(),_(this.options).extend(a.opts),a.sceneFunc(this)),this.options.sort&&!_.isFunction(this.options.sort)&&(this.options.sort=function(a,b){return a.p.z-b.p.z})},each:function(a){for(var b=0,c=this.items.length;c>b;b++)a.call(this.items[b],arguments[1],arguments[2])},eachInvoke:function(a){for(var b=0,c=this.items.length;c>b;b++)this.items[b][a].call(this.items[b],arguments[1],arguments[2])},insert:function(a){return this.items.push(a),a.parent=this,a.p&&(this.index[a.p.id]=a),this.trigger("inserted",a),a.trigger("inserted",this),a},remove:function(a){this.removeList.push(a)},forceRemove:function(a){var b=_(this.items).indexOf(a);-1!=b&&(this.items.splice(b,1),a.destroy&&a.destroy(),a.p.id&&delete this.index[a.p.id],this.trigger("removed",a))},pause:function(){this.paused=!0},unpause:function(){this.paused=!1},step:function(a){if(this.paused)return!1;if(this.trigger("prestep",a),this.eachInvoke("step",a),this.trigger("step",a),this.removeList.length>0){for(var b=0,c=this.removeList.length;c>b;b++)this.forceRemove(this.removeList[b]);this.removeList.length=0}},draw:function(a){this.options.sort&&this.items.sort(this.options.sort),this.trigger("predraw",a),this.eachInvoke("draw",a),this.trigger("draw",a)}}),a.activeStage=0,a.stage=function(b){return b=void 0===b?a.activeStage:b,a.stages[b]},a.stageScene=function(b,c,d){d=d||a.Stage,_(b).isString()&&(b=a.scene(b)),c=c||0,a.stages[c]&&a.stages[c].destroy(),a.stages[c]=new d(b),a.loop||a.gameLoop(a.stageGameLoop)},a.stageGameLoop=function(b){a.ctx&&a.clear();var c=a.backgrounds[a.bgIndex];a.ctx.drawImage(a.asset("background.jpg"),c.x,c.y,c.w,c.h,0,0,a.width,a.height);for(var d=0,e=a.stages.length;e>d;d++){a.activeStage=d;var f=a.stage();f&&(f.step(b),f.draw(a.ctx))}a.activeStage=0}};
Quintus.Screen=function(a){return a.buttons=[],a.Screen=a.GameObject.extend({init:function(b){this.p=_.extend({images:[],titles:[],buttons:[]},b||{}),_.each(this.p.buttons,function(b){a.buttons.push({name:b.name,width:b.dy,height:b.dh,x:b.dx,y:b.dy})})},step:function(){},draw:function(b){b||(b=a.ctx);var c="Author: bruceTse. Inspired by [Stick Hero]";b.fillStyle="#444",b.textAlign="center",b.font="normal 14px '微软雅黑' Arial",b.fillText(c,a.width/2,a.height-10);var d=this.p;_.each(d.images,function(a){b.drawImage(a.asset,a.sx,a.sy,a.sw,a.sh,a.dx,a.dy,a.dw,a.dh)}),b.fillStyle="#000",b.font="bold 40px '微软雅黑' Arial",b.textAlign="center",_.each(d.titles,function(a){b.fillText(a.text,a.x,a.y)}),_.each(d.buttons,function(a){b.drawImage(a.asset,a.sx,a.sy,a.sw,a.sh,a.dx,a.dy,a.dw,a.dh)})}}),a};
$(function(){function a(){s.el.on("touchstart mousedown",function(){s.stage().trigger("press-down"),event.preventDefault()}),s.el.on("touchend touchcancel mouseup",function(a){s.stage().trigger("press-up"),c(a.originalEvent),a.preventDefault()})}function b(a){var b=s.el,c=a.pageX,d=a.pageY,e=b.offset(),f=(b.attr("width")||s.width)*(c-e.left)/b.width(),g=(b.attr("height")||s.height)*(d-e.top)/b.height();return{x:f,y:g}}function c(a){var c=!!("ontouchstart"in window);if(c)for(touches=a.changedTouches,i=0,len=touches.length;i<len;i++){var d=touches[i],e=b(d),f=!1;if(_.each(s.buttons,function(a){e.x>=a.x&&e.x<=a.x+a.width&&e.y>a.y&&e.y<=a.y+a.height&&(f=!0,s.stage().trigger(a.name))}),f)break}else{var e=b(a);_.each(s.buttons,function(a){e.x>=a.x&&e.x<=a.x+a.width&&e.y>a.y&&e.y<=a.y+a.height&&(f=!0,s.stage().trigger(a.name))})}}function d(){$("#share-text").text('" '+WeiXin.shareTitle+' "'),$("#mask").css({display:"block",width:window.innerWidth,height:window.innerHeight}),$("#return").on("mouseup touchend",e)}function e(a){WeiXin.shareTitle="小黄人过河",a.preventDefault(),$("#mask").css("display","none").off("mouseup touchend",e)}function f(){s.el.addClass("bounce"),setTimeout(function(){s.el.removeClass("bounce"),s.stageScene("over")},1200)}function g(){var a=.25+.02*Math.sqrt(s.points);return a>.4&&(a=.4),a}function h(){return Math.abs(.3*Math.sin(.2*s.points+Math.PI/2))+.2}function j(){return 1-g()-h()}function k(){var a=[{type:"s",p:g()},{type:"m",p:h()},{type:"l",p:j()}];a.sort(function(a,b){return a.p>b.p});var b,c=Math.random();return b=c<a[0].p?t[a[0].type]:c>=a[0].p&&c<a[0].p+a[1].p?t[a[1].type]:t[a[2].type],b[Math.floor(Math.random()*b.length)]}function l(){var a=!1,b=$("body");s.backgrounds=[{x:0,y:0,w:400,h:535,style:"#3D89FD"},{x:405,y:0,w:400,h:535,style:"#61D5FF"}],s.bgIndex=1,s.compileSheets("sprites.png","man.json"),s.scene("game",new s.Scene(function(c){a?(s.bgIndex=(s.bgIndex+1)%2,b.css("background",s.backgrounds[s.bgIndex].style)):a=!0;var d=new s.Bank({type:"left",x:0,w:60}),e=Math.max(50,Math.floor(90*Math.random()));s.gap=Math.max(q,Math.floor(Math.random()*(s.width-d.p.w-d.p.x-e)));var f=new s.Bank({x:d.p.x+d.p.w+s.gap,w:e,type:"right"}),g=new s.Bridge({x:d.p.w+d.p.x-m,lBank:d,rBank:f});c.insert(d),c.insert(f),c.insert(g),c.insert(new s.Man({x:d.p.w+d.p.x-20,y:s.height-n-27,frame:0})),c.insert(new s.GamePoints);var h;c.bind("build-bank",function(){var a=k();a>=60?(s.gap=Math.max(q,Math.floor(Math.random()*(s.width-d.p.w-d.p.x))),s.gap=Math.min(s.gap,s.width-d.p.w-d.p.x-a)):s.gap=Math.max(q,Math.floor(Math.random()*(s.width-d.p.w-d.p.x-a))),h=new s.Bank({x:f.p.x+f.p.w+s.gap,w:a,type:"right"}),c.insert(h)}),c.bind("build-bridge",function(){d=f,d.setType("left"),f=h,g=new s.Bridge({x:d.p.w+d.p.x-m,lBank:d,rBank:f}),c.insert(g)}),c.bind("press-down",function(){s.down=!0,s.up=!1}),c.bind("press-up",function(){s.down=!1,s.up=!0})})),s.scene("start",new s.Scene(function(a){var b=new s.Screen({images:[{asset:s.asset("sprites.png"),sx:10,sy:60,sw:225,sh:175,dx:s.width/2-108,dy:20,dw:225,dh:175}],buttons:[{asset:s.asset("sprites.png"),name:"start",sx:236,sy:60,sw:188,sh:41,dx:s.width/2-94,dy:225,dw:188,dh:41},{asset:s.asset("sprites.png"),name:"share",sx:236,sy:108,sw:188,sh:40,dx:s.width/2-94,dy:295,dw:188,dh:40}]});a.insert(b),a.bind("share",function(){WeiXin.shareTitle="[小黄人过河]游戏, 想不想知道你有多6? 想自虐吗? 来挑战吧!",d()}),a.bind("start",function(){s.stageScene("game")})})),s.scene("over",new s.Scene(function(a){var b=new s.Screen({titles:[{text:"no zuo no die",x:s.width/2,y:100},{text:"分数: "+s.points,x:s.width/2,y:n}],buttons:[{asset:s.asset("sprites.png"),name:"replay",sx:236,sy:152,sw:188,sh:40,dx:s.width/2-94,dy:200,dw:188,dh:40},{asset:s.asset("sprites.png"),name:"show",sx:236,sy:198,sw:188,sh:40,dx:s.width/2-94,dy:270,dw:188,dh:40}]});a.insert(b),a.bind("replay",function(){s.stageScene("game")}),a.bind("show",function(){WeiXin.shareTitle="我在[小黄人过河]游戏中怒砍"+s.points+"分, 6到没朋友! you can? you up!",d()})})),s.stageScene("start")}var m=3,n=150,o=60,p=10,q=15,r=500,s=window.Q=Quintus().include("Sprites, Scenes, Screen").setup("",{maximize:!0,fullScreen:!0}),t={s:[10,15,20,25],m:[30,35,40,45,50,55],l:[60,70,80,90]};a(),s.points=0,s.delay=.25,s.Bridge=s.Rectangle.extend({init:function(a){this._super(_.extend({w:m,y:s.height-n,z:1,speed:320,ang:0,waitTime:0,scaling:!1,scaled:!1,rotating:!1,rotated:!1,moved:!1},a||{}))},step:function(a){var b=this.p;s.bankMove||s.manMove||!s.down||b.scaled||b.rotated||(s.bridgeScale=!0,b.scaling=!0,b.h+=b.speed*a,b.y-=b.speed*a),s.up&&b.scaling&&(b.scaling=!1,b.scaled=!0),s.up&&b.scaled&&b.waitTime<s.delay&&(b.waitTime+=a),s.up&&b.rotated&&!b.moved&&(s.manMove=!0,b.moved=!0,s.pass=!1,b.w+b.x>b.rBank.p.x&&b.w+b.x<b.rBank.p.w+b.rBank.p.x?(s.moveToX=b.rBank.p.w+b.rBank.p.x,s.pass=!0):(b.w+b.x<=b.rBank.p.x||b.w+b.x>=b.rBank.p.w+b.rBank.p.x)&&(s.moveToX=b.lBank.p.w+b.lBank.p.x+b.w+20,s.pass=!1)),s.bankMove&&b.rotated&&b.x+b.w>0?b.x-=r*a:s.bankMove&&b.rotated&&this.destroy(),s.pass&&b.moved&&!s.manMove&&b.x+b.w<b.rBank.p.x&&(b.x=b.rBank.p.x-b.w+5)},draw:function(a){a||(a=s.ctx);var b=this.p;if(b.waitTime>=s.delay)if(s.up&&b.scaled&&!b.rotated&&(b.rotating=!0,b.ang+=5,a.save(),a.translate(b.x+m,s.height-n),a.rotate(b.ang*Math.PI/180),a.translate(-b.x-m,n-s.height),a.fillStyle=b.color,a.fillRect(b.x,b.y,b.w,b.h),a.restore()),90!==b.ang||b.rotated)b.rotated&&this._super(a);else{b.rotated=!0,b.rotating=!1;var c=b.h;b.x=b.lBank.p.x+b.lBank.p.w,b.h=b.w,b.w=c,b.y=s.height-n-b.h/3,this._super(a)}else this._super(a)}}),s.Bank=s.Rectangle.extend({init:function(a){this._super(_.extend({x:0,y:s.height-n,z:2,w:p,h:n,type:""},a||{}))},step:function(a){var b=this.p;s.bankMove&&("right"==b.type?b.x+b.w>o?b.x-=r*a:(s.bankMove=!1,s.stage().trigger("build-bridge")):s.bankMove&&(b.x-=r*a),b.x+b.w<=0&&this.destroy())},setType:function(a){this.p.type=a}}),s.Man=s.Sprite.extend({init:function(a){this._super(_(a).extend({sheet:"man",speed:180,frameCount:0,z:3,waitTime:0}))},step:function(a){var b=this.p;s.down||s.manMove?s.manMove||(b.frameCount=(b.frameCount+1)%13,b.frame=Math.floor(b.frameCount/4)):b.frame=0,s.bankMove&&!s.manMove&&b.x+20>o&&(b.x-=r*a),s.manMove&&(b.waitTime>=s.delay?(b.frameCount=(b.frameCount+1)%21,b.frame=4+Math.floor(b.frameCount/4),b.x+20<s.moveToX&&b.x<s.width?b.x+=b.speed*a:s.pass?(b.waitTime=0,s.manMove=!1,s.bankMove=!0,s.points+=1,s.stage().trigger("build-bank")):b.y<s.height?b.y+=800*a:(s.manMove=!1,s.bankMove=!1,f())):b.waitTime+=a)}}),s.GamePoints=s.GameObject.extend({init:function(a){s.points=0,this.p=_({x:s.width/2,y:50,z:0}).extend(a||{})},step:function(){},draw:function(a){a||(a=s.ctx),a.save(),a.fillStyle="#fff",a.textAlign="center",a.font="bold 40px '微软雅黑' Arial",a.fillText(s.points+"",this.p.x,this.p.y),a.restore()}}),s.assets["man.json"]={man:{sx:0,sy:0,cols:10,tilew:40,tileh:55,frames:10}},s.load(["sprites.png","background.jpg"],l,{progressCallback:function(a,b){if(b>=a){var c=s.ctx;c.fillStyle="#fff",c.textAlign="center",c.font='normal 16px "微软雅黑" Arial',c.fillText("loading...",s.width/2,s.height/2)}}})});